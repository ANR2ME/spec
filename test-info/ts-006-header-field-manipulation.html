<h1>Test description</h1>
<p>It performs HTTP requests with request headers that vary capitalization towards
a backend. If the headers reported by the server differ from the ones we sent,
then we have detected tampering.</p>
<p>If the optional headers yaml file is not supplied, the
headers will be constructed as so:</p>
<p>{
  "User-Agent": [random.choice(net.userAgents)],
  "Accept":["text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8"],
  "Accept-Encoding": ["gzip,deflate,sdch"],
  "Accept-Language": ["en-US,en;q=0.8"],
  "Accept-Charset": ["ISO-8859-1,utf-8;q=0.7,*;q=0.3"],
  "Host": [randomStr(15)+'.com']
}</p>
<p>The Host header is a random string of 15 characters + .com
The User-Agent header is randomly selected from one of the following:</p>
<p>[
  "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.7) Gecko/20091221 Firefox/3.5.7",
  "Mozilla/5.0 (iPhone; U; CPU iPhone OS 3 1 2 like Mac OS X; en-us) AppleWebKit/528.18 (KHTML, like Gecko) Mobile/7D11",
  "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2) Gecko/20100115 Firefox/3.6",
  "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2) Gecko/20100115 Firefox/3.6",
  "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2) Gecko/20100115 Firefox/3.6",
  "Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.2) Gecko/20100115 Firefox/3.6",
  "Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.2) Gecko/20100115 Firefox/3.6",
  "Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.2) Gecko/20100115 Firefox/3.6",
  "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.7) Gecko/20091221 Firefox/3.5.7",
  "Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.1.7) Gecko/20091221 Firefox/3.5.7 (.NET CLR 3.5.30729)")
]</p>
<p>A request is then made towards the backend.</p>
<p>We have 5 categories of tampering:</p>
<h2>total</h2>
<p>The response is not a json object and therefore we were not
able to reach the ooniprobe test backend</p>
<h2>request_line_capitalization</h2>
<p>HTTP Request line (e.x. GET / HTTP/1.1) does not match the capitalization we set.</p>
<h2>header_field_number</h2>
<p>The number of headers we sent does not match those the backend received.</p>
<h2>header_name_capitalization</h2>
<p>The header field names do not match those that we sent.</p>
<h2>header_field_value</h2>
<p>The header field value does not match with the one we transmitted.</p>
<h1>Expected output</h1>
<h2>Parent data format</h2>
<p>df-001-httpt-000</p>
<h2>Required output data</h2>
<p>In addition to the details provided in the parent data format we add to the
report the key 'tampering', which is a dictionary containing the following keys
that correspond to the categories of tampering we detect as well as the
difference between the sent and received headers represented as a list of the
headers not present in both the sent and received headers.</p>
<h2>Semantics</h2>
<p>{
  'total': True|False,
  'request_line_capitalization': True|False,
  'header_name_capitalization': True|False,
  'header_field_value': True|False,
  'header_field_number': True|False
  'header_name_diff': []
}</p>
<h2>Example output sample</h2>
<p>```
  ###########################################
  # OONI Probe Report for http_header_field_manipulation (0.1.3)
  # Wed Oct  9 10:57:42 2013
  ###########################################</p>
<hr />
<p>input_hashes: []
  options: [-b, 'http://12.34.56.78']
  probe_asn: AS1234
  probe_cc: US
  probe_ip: 127.0.0.1
  software_name: ooniprobe
  software_version: 1.0.0-rc3
  start_time: 1381316262.744312
  test_name: http_header_field_manipulation
  test_version: 0.1.3
  ...</p>
<hr />
<p>agent: agent
  input: null
  requests:
  - request:
      body: null
      headers:
      - - accEpt-LANGuAGE
        - ['en-US,en;q=0.8']
      - - aCcepT-ENCoDIng
        - ['gzip,deflate,sdch']
      - - AccEpT
        - ['text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8']
      - - uSEr-AGenT
        - ['Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2) Gecko/20100115
            Firefox/3.6']
      - - aCCEPT-cHarseT
        - ['ISO-8859-1,utf-8;q=0.7,<em>;q=0.3']
      - - hoSt
        - [XJs7REREvvxO3wL.com]
      method: geT
      url: http://12.34.56.78
    response:
      body: '{"headers_dict": {"accEpt-LANGuAGE": ["en-US,en;q=0.8"], "aCcepT-ENCoDIng":
        ["gzip,deflate,sdch"], "hoSt": ["XJs7REREvvxO3wL.com"], "AccEpT": ["text/html,application/xhtml+xml,application/xml;q=0.9,</em>/<em>;q=0.8"],
        "uSEr-AGenT": ["Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2) Gecko/20100115
        Firefox/3.6"], "aCCEPT-cHarseT": ["ISO-8859-1,utf-8;q=0.7,</em>;q=0.3"], "Connection":
        ["close"]}, "request_line": "geT / HTTP/1.1", "request_headers": [["Connection",
        "close"], ["accEpt-LANGuAGE", "en-US,en;q=0.8"], ["aCcepT-ENCoDIng", "gzip,deflate,sdch"],
        ["AccEpT", "text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8"],
        ["uSEr-AGenT", "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2) Gecko/20100115
        Firefox/3.6"], ["aCCEPT-cHarseT", "ISO-8859-1,utf-8;q=0.7,*;q=0.3"], ["hoSt",
        "XJs7REREvvxO3wL.com"]]}'
      code: 200
      headers: []
  socksproxy: null
  tampering:
    header_field_name: false
    header_field_number: false
    header_field_value: false
    header_name_capitalization: false
    header_name_diff: []
    request_line_capitalization: false
    total: false
  ...
```</p>
<h1>Privacy considerations</h1>
<p>If the user is behind a transparent HTTP proxy that sets the X-Forwarded-For
header their IP address will end up being part of the final report.</p>