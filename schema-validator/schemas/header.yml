---
$schema: http://json-schema.org/draft-04/schema#
title: OONI-Probe report header
definitions:
  bucket_date:
    type: string
    pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
  semantic_version:
    type: string
    # copy paste from: https://github.com/semver/semver/issues/232#issue-48635632
    # with the only change of adding support for the "." separator for the suffix label `(-|\.)`
    pattern: '^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)((-|\.)(0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(\.(0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*)?(\+[0-9a-zA-Z-]+(\.[0-9a-zA-Z-]+)*)?$'
  ip_address:
    type: string
    format: ipv4
  test_version:
    type: string
    pattern: "[0-9]+.[0-9]+"
  date_time:
    type: string
    pattern: "[0-9]{4}-[0-9]{1,2}-[0-9]{1,2} [0-9]{2}:[0-9]{2}:[0-9]{2}"
properties:
  bucket_date:
    $ref: "#/definitions/bucket_date"
  data_format_version:
    $ref: "#/definitions/semantic_version"
  id:
    anyOf:
    - type: string
    - type: "null"
  input:
    anyOf:
      - type: string
      - type: "null"
      - type: array
  options:
    type: array
  probe_asn:
    type: string
  probe_cc:
    type: string
  probe_ip:
    $ref: "#/definitions/ip_address"
  report_filename:
    type: string
  report_id:
    type: string
  software_name:
    type: string
    enum:
    - "ooniprobe"
    - "ooniprobe-android"
    - "ooniprobe-ios"
    - "measurement-kit"
  software_version:
    $ref: "#/definitions/semantic_version"
  test_helpers:
    type: object
  input_hashes:
    type: array
  probe_city:
    type:
      - "null"
      - string
  backend_version:
    anyOf:
    - $ref: "#/definitions/semantic_version"
    - type: "null"
  test_name:
    type: string
  test_runtime:
    anyOf:
      - type: number
        minimum: 0
      - type: "null"
  test_start_time:
    $ref: "#/definitions/date_time"
  test_version:
    $ref: "#/definitions/test_version"
required:
  # These are added by the pipeline and hence are not required
  #- report_filename
  #- backend_version

  - data_format_version
  - id
  - input
  - options
  - probe_asn
  - probe_cc
  - probe_ip
  - report_id
  - software_name
  - software_version
  - test_helpers
  - input_hashes
  - probe_city
  - test_name
  - test_runtime
  - test_start_time
  - test_version
