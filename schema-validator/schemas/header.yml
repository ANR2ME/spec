---
$schema: http://json-schema.org/draft-04/schema#
title: OONI-Probe report header
definitions:
  bucket_date:
    type: string
    pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
  semantic_version:
    type: string
    pattern: "^[0-9]+.[0-9]+.[0-9]+$"
  uuid-v4:
    type: string
    pattern: "[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}\\Z"
  ip-address:
    type: string
    format: ipv4
  test-version:
    type: string
    pattern: "[0-9]+.[0-9]+"
  date-time:
    type: string
    pattern: "[0-9]{4}-[0-9]{1,2}-[0-9]{1,2} [0-9]{2}:[0-9]{2}:[0-9]{2}"
properties:
  bucket_date:
    $ref: "#/definitions/bucket_date"
  data_format_version:
    $ref: "#/definitions/semantic_version"
  id:
    $ref: "#/definitions/uuid-v4"
  input:
    $ref: "#/definitions/ip-address"
  options:
    type: array
  probe_asn:
    type: string
  probe_cc:
    type: string
  probe_ip:
    $ref: "#/definitions/ip-address"
  report_filename:
    type: string
  report_id:
    type: string
  software_name:
    type: string
    enum: [ 'ooniprobe' ]
  software_version:
    $ref: "#/definitions/semantic_version"
  test_helpers:
    type: object
  input_hashes:
    type: array
  probe_city:
    type:
      - 'null'
      - string
  backend_version:
    $ref: "#/definitions/semantic_version"
  test_name:
    type: string
  test_runtime:
    anyOf:
      - type: number
        minimum: 0
      - type: "null"
  test_start_time:
    $ref: "#/definitions/date-time"
  test_version:
    $ref: "#/definitions/test-version"
required:
  - bucket_date
  - data_format_version
  - id
  - input
  - options
  - probe_asn
  - probe_cc
  - probe_ip
  - report_filename
  - report_id
  - software_name
  - software_version
  - test_helpers
  - input_hashes
  - probe_city
  - backend_version
  - test_name
  - test_runtime
  - test_start_time
  - test_version
